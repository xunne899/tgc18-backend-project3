{{#extends 'base'}}

{{#block 'content'}}
<h1>Products</h1>

<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Created Date</th>
             <th>Type</th>
            <th>Name</th>
            <th>Country</th>
            <th>Description</th>
            <th>Ingredients</th>
            <th>Packaging</th>
            <th>Shelf Life(Yrs)</th>
            <th>Cuisine Style</th>
             <th>Vegan</th>
             <th>Halal</th>
            <th>Image</th>
            <th></th>
            <th></th>
            
        </tr>

    </thead>
    <tbody>
            <tr >
                <td >
                    {{product.id}}
                </td>
                  <td >
                    {{moment product.created_date format="YYYY-MM-DD"}}
                </td>
                 <td >
                    {{product.type.type}}
                </td>
                <td >
                    {{product.name}}
                </td>
                <td >
                    {{product.country.country}}
                </td>
                <td>
                    {{product.description}}
                </td>
               
                  <td >
                    {{#each product.ingredients}}
                     <span>{{this.ingredient}}</span>
                      {{/each}}
                </td>
                  {{!-- <td >
                    {{this.sizes.size}}
                </td> --}}
                 <td>
                    {{product.packaging.packaging}}
                </td>
                 <td>
                    {{product.shelf_life}}
                </td>
               {{!-- <td >
                    
                     {{this.spiciness.spiciness}}</span>
                   
                </td> --}}
                  <td >
              {{#each product.cuisine_styles}}
                     <span>{{this.cuisine_style}}</span>
                      {{/each}}
                    
                </td>
                 <td>
                    {{product.vegan}}
                </td>
                  <td >
                    {{product.halal}}
                </td>
                 <td>
                <img src="{{product.image_url}}" style="height:200px, width:400px" class="img-fluid"/>
                </td>
                 </tr>
                 </tbody>
</table>


<h1>Variants</h1>

    <table class="table">
    <thead>
        <tr>
             <th></th>
            <th>ID</th>
            <th>Stock</th>
             <th>Cost</th>
            <th>Spiciness</th>
            <th>Size</th>
            
        </tr>

    </thead>
   
    <tbody>
        {{#each variants}}
            <tr >
                  <td >
                  <img src="{{this.image_url}}" width="200" height="500" class="img-fluid"/>
                </td>
                <td >
                    {{this.id}}
                </td>
                  <td >
                    {{this.stock}}
                </td>
                 <td >
                    {{this.cost}}
                </td>
                <td >
                    {{this.spiciness.spiciness}}
                </td>
                <td>
                    {{this.size.size}}
                </td>
                <td>
                 <a href="/products/{{product.id}}/variant/{{this.id}}/update" class="btn btn-primary btn-sm">Update</a>
                       <a href="/products/{{product.id}}/variant/{{this.id}}/delete" class="btn btn-danger btn-sm">Delete</a>
                  </td>
                  {{/each}}
                    <a  href="/products/{{product.id}}/variant/create" class="btn btn-primary">Add Variant</a>
               
                    {{!-- <a  href="/products/create-variants" class="btn btn-primary">Add Variant</a> --}}
                   </tbody>
                    </tr>
</table>
{{/block}}

{{/extends}}
{{#block js}}

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
    integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
    crossorigin="anonymous"></script>
<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
<script>
    function generateSignature(callback, params_to_sign) {
        axios.get('/cloudinary/sign', {
            params: {
                params_to_sign
            }
        }).then(function (response) {
            callback(response.data);
        })
    }

    var myWidget = cloudinary.createUploadWidget({
        cloudName: '{{cloudinaryName}}',
        apiKey: '{{cloudinaryApiKey}}',
        uploadPreset: '{{cloudinaryPreset}}',
        uploadSignature: generateSignature
    }, (error, result) => {
        if (!error && result && result.event === "success") {
            console.log('Done! Here is the image info: ', result.info);
            // hide the upload widget 
            document.querySelector('#upload_widget').style.display = "none";

            // display the image
            document.querySelector('#id_image_url').value = result.info.url;
            document.querySelector('#uploaded_image').src = result.info.url;
            document.querySelector('#uploaded_image').style.display = 'block';
        }
    }
    )

    document.getElementById("upload_widget").addEventListener("click", function () {
        myWidget.open();
    }, false);
</script>

{{/block}}
